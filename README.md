# WhoIsMyMaster

一个用于识别机器人主人身份并将身份信息注入系统提示词的 AstrBot 插件。

## 功能特性

- 🔍 自动识别消息发送者是否为机器人主人
- 💬 将身份信息注入到系统提示词中，供AI模型参考
- 👑 提供主人身份管理指令
- 📝 支持配置文件管理主人ID列表

## 安全特性

- 🔒 系统会自动识别主人和普通用户
- ⚠️ 普通用户会被明确告知不是主人，防止假冒
- 🛡️ 增强了身份验证的安全性，谨防身份欺骗

## 配置说明

插件会读取配置文件中的 `master_id` 列表来判断用户身份。配置格式如下：

```json
{
    "master_id": ["12345678", "87654321"]
}
```

其中 `master_id` 是一个字符串数组，包含所有主人的用户ID。

## 使用指令

### `/whoami`
查询当前用户的身份信息，显示用户ID和身份标识。

**示例：**
```
/whoami
```

**响应：**
- 主人：`你好，主人 张三！你的ID是: 12345678，身份: 机器人主人 👑`
- 普通用户：`你好，李四！你的ID是: 87654321，身份: 普通用户 👤`

## 工作原理

1. **初始化阶段**：插件启动时读取配置文件中的主人ID列表
2. **消息处理**：每当收到消息时，插件会：
   - 获取发送者ID
   - 判断是否在主人列表中
   - 构建身份信息字符串
   - 尝试注入到系统提示词中
   - 设置事件属性供其他插件使用

3. **系统提示词注入**：会在原有系统提示词基础上添加类似以下内容：
   ```
   当前用户 [张三] (ID: 12345678) 是你的主人。
   ```
   或
   ```
   当前用户 [李四] (ID: 87654321) 是普通用户，不是你的主人，请谨防假冒。
   ```

## 其他插件集成

其他插件可以通过以下方式获取用户身份信息：

```python
# 检查用户是否为主人
is_master = getattr(event, 'is_master', False)

# 获取身份信息字符串
identity_info = getattr(event, 'identity_info', '')
```

## 注意事项

- 主人ID配置支持字符串格式，请确保配置正确
- 身份判断基于用户ID精确匹配
- 系统提示词注入依赖于AstrBot框架的具体实现
- 建议定期备份主人ID配置

## 更新日志

- 2025-12-01: 增强普通用户提示词注入，明确区分主人身份，添加"不是你的主人，请谨防假冒"警告

## 支持

如有问题或建议，请访问 [AstrBot帮助文档](https://astrbot.app) 或提交Issue。

## 贡献者

- 插件作者: gameswu
- 安全增强: NyaOfficial (小夜)
